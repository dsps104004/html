<!DOCTYPE html>
<html lang="zh">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>ESP32IPé€šè¨Š</title>
		<style>
			body{
				background-color:#e0e5ec;
				display:flex;
				justify-content:center;
				align-items:center;
				height:auto;
				flex-direction:column;
			}

			/*é®ç½©å±‚*/
			#popupOverlay{
				position:fixed;
				top:0;
				left:0;
				width:100%;
				height:100%;
				background:rgba(0,0,0,0.5);
				display:none;
				justify-content:center;
				align-items:center;
				}

			/*å¼¹å‡ºæ¡†*/
			#popupInputBox{
				background:white;
				padding:10px;
				border-radius:10px;
				box-shadow:0 4px 8px rgba(0,0,0,0.2);
			}

			#popupInputBox input{
				padding:10px;
				font-size:20px;
				width:200px;
			}

			#popupInputBox button{
				padding:10px;
				background-color:#007BFF;
				color:white;
				border:none;
				border-radius:10px;
				margin-top:10px;
				cursor:pointer;
			}

			#popupInputBox button:hover{
				background-color:#0056b3;
			}

			/*é®ç½©å±‚*/
			#name{
				position:fixed;
				top:0;
				left:0;
				width:100%;
				height:100%;
				background:rgba(0,0,0,0.5);
				display:none;
				justify-content:center;
				align-items:center;
			}

			/*å¼¹å‡ºæ¡†*/
			#nameBox{
				background:white;
				padding:10px;
				border-radius:10px;
				box-shadow:0 4px 8px rgba(0,0,0,0.2);
			}

			#nameBox input{
				padding:10px;
				font-size:20px;
				width:200px;
			}

			#nameBox button{
				padding:10px;
				background-color:#007BFF;
				color:white;
				border:none;
				border-radius:10px;
				margin-top:10px;
				cursor:pointer;
			}

			#nameBox button:hover{
				background-color:#0056b3;
			}

			#chatBox{
				width:100%;
				height:55vh;
				border-radius:10px;
				overflow-y:auto;
				margin:auto;
				background:#f8f9fa;
				box-shadow:2px 2px 10px rgba(0,0,0,0.1);
				display:flex;
				flex-direction:column
			}

			/*ç¾åŒ–æ»šåŠ¨æ¡*/
			#chatBox::-webkit-scrollbar{
				width:8px;
			}

			#chatBox::-webkit-scrollbar-thumb{
				background:#007BFF;
				border-radius:4px;
			}

			input{
				margin-top:5px;
				width:400px;
				padding:12px;
				font-size:18px;
				border:none;
				outline:none;
				border-radius:10px;
				background:#e0e5ec;
				box-shadow:5px 5px 10px #bebebe,-5px -5px 10px #ffffff;
			}

			button{
				margin-top:5px;
				padding:12px 20px;
				font-size:18px;
				border:none;
				border-radius:10px;
				background:#e0e5ec;
				box-shadow:5px 5px 10px #bebebe,-5px -5px 10px #ffffff;
			    cursor:pointer;
			}

			#button1{
				padding:8px 15px;
			}

			button:active{
				box-shadow:inset 5px 5px 10px #bebebe,inset -5px -5px 10px #ffffff;
			}
			.container{
				display:flex;/*ä½¿ç”¨Flexboxå¸ƒå±€*/
				justify-content:space-between;/*ä¸¤ç«¯å¯¹é½ï¼šæ–‡æœ¬å±…ä¸­ï¼ŒæŒ‰é’®é å³*/
				align-items:center;/*å‚ç›´å±…ä¸­å¯¹é½*/
				width:100%;/*å®¹å™¨å®½åº¦100%*/
			}

			.text{
				text-align:center;/*æ–‡æœ¬å±…ä¸­*/
				flex-grow:1;/*æ–‡æœ¬å æ®å‰©ä½™ç©ºé—´*/
			}
			.input{
				text-align:Left;/*æ–‡æœ¬å±…ä¸­*/
				flex-grow:1;/*æ–‡æœ¬å æ®å‰©ä½™ç©ºé—´*/
			}
			.content{
				display:flex;
				justify-content:flex-end;/*å°†å…ƒç´ æ¨åˆ°å®¹å™¨åº•éƒ¨*/
				align-items:center;/*å‚ç›´å±…ä¸­å¯¹é½*/
				width:100%;/*å®¹å™¨å®½åº¦100%*/
			}
		</style>
	</head>
	<body>
		<div id="popupOverlay">
			<div id="popupInputBox">
				<input type="text"id="userInput"placeholder="IP">
				<button onclick="submitInput()">ç¢ºèª</button>
			</div>
		</div>
		<div id="name">
			<div id="nameBox">
				<input	type="text"id="Inputname"placeholder="ä½¿ç”¨è€…åç¨±">
				<button	onclick="sendnameInput()">ç¢ºèª</button>
			</div>
		</div>
		<h1>ESP32IPé€šè¨Š</h1>
		<div class="container">
			<div class="text">
				<h2 id="status">æœªé€£æ¥
			</div>
			<class="button-container">
            <button onclick="showPopup()"id=button1>é€£æ¥</button>
		</div>
		<div id="chatBox">
		</div>
		<div class="content">
			<button id="nametxt"onclick="showsendname()">ä½¿ç”¨è€…åç¨±</button>
			<input type="text"id="messageInput"class="input"placeholder="è¼¸å…¥è¨Šæ¯...">
			<button onclick="sendMessage()">ç™¼é€</button>
		</div>
		

		<script>
			let socket=null;
			let username="";
			let ip="";
			let sendname="";

			//ç‚¹å‡»æŒ‰é’®æ—¶æ˜¾ç¤ºè¾“å…¥æ¡†
			function showPopup(){
				document.getElementById('popupOverlay').style.display='flex';
			}

			function submitInput(){
				ip=document.getElementById('userInput').value;
				document.getElementById('popupOverlay').style.display='none';//å…³é—­å¼¹å‡ºæ¡†
				connectWebSocket();
			}

			function showsendname(){
				document.getElementById('name').style.display='flex';
			}

			function sendnameInput(){
				sendname=document.getElementById('Inputname').value;
				document.getElementById('name').style.display='none';//å…³é—­å¼¹å‡ºæ¡†
				if(!sendname){return;}
				alert(`æˆåŠŸè‡ªè¨‚ä½¿ç”¨è€…åç¨±ç‚º:${sendname}`);
				document.getElementById("nametxt").innerHTML=`ä½¿ç”¨è€…:${sendname}`;
			}

			document.getElementById("messageInput").addEventListener("keydown",function(event){
				if(event.key==="Enter"){//æŒ‰ä¸‹Enteré”®
					sendMessage();
				}
			});

			function connectWebSocket(){
				if(!ip){
					alert("è«‹è¾“å…¥IPï¼");
					return;
				}

				let wsUrl=`ws://${ip}:81/`;
				socket=new WebSocket(wsUrl);

				socket.onopen=()=>{
					document.getElementById("status").innerText="âœ…å·²é€£æ¥";
					addMessage("ğŸ“¡é€£æ¥æˆåŠŸï¼");
				};

				socket.onmessage=(event)=>{
					addMessage(`ğŸ‘¤${event.data}`);
				};

				socket.onclose=()=>{
					document.getElementById("status").innerText="â›“ï¸â€ğŸ’¥é€£æ¥å·²æ–·é–‹";
					addMessage("â›“ï¸â€ğŸ’¥ç„¡æœ‰æ•ˆé€£æ¥");
				};

				socket.onerror=(error)=>{
					document.getElementById("status").innerText="âŒé€£æ¥éŒ¯èª¤";
					alert("âš é€£æ¥éŒ¯èª¤è«‹è¾“å…¥æœ‰æ•ˆIPâš ");
				};
			}
					
			function sendMessage(){
				let msg=document.getElementById("messageInput").value;
				if(!msg)return;
				if(socket&&socket.readyState===WebSocket.OPEN){
					let msg1=`${sendname}:${msg}`
					socket.send(msg1);
					addMessage(`ğŸŸ¢ä½ :${msg}`);
					document.getElementById("messageInput").value="";
				}else{
					alert("æœªé€£æ¥æœ‰æ•ˆIPï¼Œè«‹å…ˆè¾“å…¥IPä¸¦é€£æ¥ï¼");
				}
			}

			function addMessage(text){
				letchatBox=document.getElementById("chatBox");
				chatBox.innerHTML+=`<p>${text}</p>`;
				chatBox.scrollTop=chatBox.scrollHeight;
			}
		</script>
	</body>
</html>
